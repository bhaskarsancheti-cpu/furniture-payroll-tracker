<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Attendance & Payroll Tracker</title>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <!-- optional while testing, leave out app-check for now -->

  <style>
    /* Minimal layout to match app.js expectations (IDs, classes) */
    :root{--bg:#faf9f7;--card:#fff;--muted:#666;--accent:#2c6f6f}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui; margin:0; background:var(--bg); color:#111}
    .app-container{max-width:1200px;margin:24px auto;padding:20px}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .tabs{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
    .tab{background:var(--card);padding:8px 12px;border-radius:8px;cursor:pointer}
    .tab.active{background:var(--accent);color:#fff}
    .tab-content{display:none}
    .tab-content.active{display:block}
    .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    .btn.secondary{background:#eee;color:#111}
    .form-control{padding:8px;border-radius:6px;border:1px solid #ddd;width:100%}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35)}
    .modal.active{display:flex}
    .modal-content{width:680px;max-width:95%;background:#fff;border-radius:8px;padding:16px}
    .toast{position:fixed;right:20px;bottom:20px;padding:10px 14px;border-radius:8px;background:var(--accent);color:#fff;display:none}
    .toast.show{display:block}
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div style="font-weight:700">Attendance & Payroll Tracker</div>
      <div>
        <label for="monthYear" style="color:#666;font-size:13px;margin-right:8px">Month:</label>
        <input id="monthYear" type="month">
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="dashboard">Dashboard</div>
      <div class="tab" data-tab="employees">Employees</div>
      <div class="tab" data-tab="employee-management">Employee Management</div>
      <div class="tab" data-tab="daily-labor">Daily Labour</div>
      <div class="tab" data-tab="advances">Advances</div>
      <div class="tab" data-tab="summary">Monthly Summary</div>
      <div class="tab" data-tab="export">Export/Backup</div>
    </div>

    <!-- (body content — IDs and structure expected by app.js) -->
    <div id="dashboard" class="tab-content active">
      <div>
        Total Payroll: <span id="totalPayroll">₹0</span> |
        Attendance Rate: <span id="attendanceRate">0%</span> |
        Total Hours: <span id="totalHours">0</span> |
        Active Employees: <span id="activeEmployees">0</span>
      </div>
      <div id="employeeCards" style="margin-top:12px"></div>
    </div>

    <div id="employees" class="tab-content" style="display:none">
      <div id="employeesList">
        <h3>Select an Employee</h3>
        <div id="employeeSelectCards"></div>
      </div>
      <div id="employeeDetail" style="display:none">
        <button class="btn secondary" onclick="showEmployeesList()">← Back to Employees</button>
        <div id="employeeDetailHeader"></div>
        <button class="btn" onclick="openAttendanceModal()">+ Add Attendance Entry</button>
        <div id="employeeCalendar" style="margin-top:12px"></div>
        <div id="attendanceRecords" style="margin-top:12px"></div>
        <div id="employeePayrollSummary" style="margin-top:12px"></div>
      </div>
    </div>

    <div id="employee-management" class="tab-content" style="display:none">
      <h3>Employee Management</h3>
      <button class="btn" onclick="document.getElementById('addEmployeeModal').classList.add('active')">+ Add Employee</button>
      <div id="employeesTable" style="margin-top:12px"></div>
    </div>

    <div id="daily-labor" class="tab-content" style="display:none">
      <h3>Daily Labour</h3>
      <form id="dailyLaborForm">
        <div style="display:flex;gap:8px">
          <input id="laborDate" class="form-control" type="date" required>
          <input id="laborName" class="form-control" type="text" placeholder="Name" required>
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="laborWage" class="form-control" type="number" value="750" required>
          <input id="laborHours" class="form-control" type="number" value="8" step="0.1" required>
        </div>
        <div style="margin-top:8px"><input id="laborNotes" class="form-control" type="text" placeholder="Notes"></div>
        <div style="margin-top:8px"><button class="btn" type="submit">Add Daily Labour</button></div>
      </form>
      <div id="dailyLaborTableBody" style="margin-top:12px"></div>
      <div>Total Labour Cost: <span id="totalLaborCost">₹0</span></div>
    </div>

    <div id="advances" class="tab-content" style="display:none">
      <h3>Advances</h3>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <select id="advanceFilterEmployee" class="form-control" style="width:200px;display:inline-block"></select>
          <select id="advanceFilterStatus" class="form-control" style="width:150px;display:inline-block">
            <option value="">All Status</option><option>Pending</option><option>Partial</option><option>Settled</option>
          </select>
        </div>
        <div><button class="btn" onclick="openAddAdvanceModal()">+ Add Advance</button></div>
      </div>
      <div id="advancesTableBody" style="margin-top:12px;"></div>
    </div>

    <div id="summary" class="tab-content" style="display:none">
      <h3>Monthly Summary</h3>
      <div id="summaryTableBody"></div>
    </div>

    <div id="export" class="tab-content" style="display:none">
      <h3>Export / Backup</h3>
      <button id="downloadBackupBtn" class="btn secondary">Download JSON Backup</button>
    </div>
  </div>

  <!-- Attendance Modal (IDs must match app.js) -->
  <div id="attendanceModal" class="modal" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Add Attendance</h3>
        <button onclick="closeAttendanceModal()" class="close-btn">✕</button>
      </div>
      <form id="attendanceForm">
        <select id="entryEmployee" class="form-control" required></select>
        <input id="entryDate" type="date" class="form-control" required>
        <select id="entryStatus" class="form-control">
          <option value="Present">Present</option>
          <option value="Half-day">Half-day</option>
          <option value="Leave">Leave</option>
          <option value="Absent">Absent</option>
        </select>
        <input id="entryStartTime" type="time" class="form-control">
        <input id="entryEndTime" type="time" class="form-control">
        <input id="entryNotes" class="form-control" type="text" placeholder="Notes">
        <div>Break: <span id="computedBreak">30 mins</span> • Expected: <span id="computedExpectedHours">0 hrs</span> • Net: <span id="computedNetHours">0 hrs</span></div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
          <button class="btn" type="submit">Save Attendance</button>
          <button class="btn secondary" type="button" onclick="closeAttendanceModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Advance Modal -->
  <div id="addAdvanceModal" class="modal" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Add Advance</h3>
        <button onclick="document.getElementById('addAdvanceModal').classList.remove('active')" class="close-btn">✕</button>
      </div>
      <form id="addAdvanceForm">
        <select id="advanceEmployee" class="form-control" required></select>
        <input id="advanceDate" type="date" class="form-control">
        <input id="advanceAmount" type="number" class="form-control" required>
        <input id="advanceReason" class="form-control" type="text">
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
          <button class="btn" type="submit">Add Advance</button>
          <button class="btn secondary" type="button" onclick="document.getElementById('addAdvanceModal').classList.remove('active')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- tiny tab script (so app.js renderers are triggered) -->
  <script>
    (function(){
      // set default month
      const m = document.getElementById('monthYear');
      if (m) {
        const now = new Date();
        m.value = now.toISOString().slice(0,7);
        m.addEventListener('change', function(){ if(window.renderDashboard) renderDashboard(); });
      }

      document.addEventListener('click', function(e){
        const t = e.target.closest('.tab');
        if(!t) return;
        const name = t.dataset.tab;
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const el = document.getElementById(name);
        if (el) el.classList.add('active');
        // call renderers
        try { if (name === 'dashboard' && window.renderDashboard) window.renderDashboard(); } catch(e){}
        try { if (name === 'employees' && window.renderEmployeeSelect) window.renderEmployeeSelect(); } catch(e){}
        try { if (name === 'daily-labor' && window.renderDailyLabor) window.renderDailyLabor(); } catch(e){}
        try { if (name === 'advances' && window.renderAdvances) window.renderAdvances(); } catch(e){}
        try { if (name === 'summary' && window.renderSummary) window.renderSummary(); } catch(e){}
      });
    })();
  </script>

  <!-- App script -->
  <script src="/app.js" data-app="attendance-v1"></script>
</body>
</html>
